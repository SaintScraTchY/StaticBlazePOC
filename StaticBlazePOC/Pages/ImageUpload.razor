@page "/image-upload"
@using StaticBlazePOC.Models
@inject GitHubService GitHubService

<h3>Upload Image</h3>

<EditForm Model="@gitUpload" OnValidSubmit="UploadImage">
    <InputFile OnChange="OnInputFileChange" />
    <br/>
    <InputText @bind-Value="@gitUpload.GitFilePath" placeholder="File Path (e.g., images/photo.jpg)" />
    <br/>
    <InputText @bind-Value="@gitUpload.GitHubPat" placeholder="GitHub PAT" />
    <br/>
    <button type="submit">Upload</button>
</EditForm>

@code {
    private FileGitUploadModel gitUpload = new FileGitUploadModel();

    private void OnInputFileChange(InputFileChangeEventArgs e)
    {
        using var stream = e.File.OpenReadStream();
        using var memoryStream = new MemoryStream();
        stream.CopyTo(memoryStream);
        gitUpload.ImageBytes = memoryStream.ToArray();
    }

    private async Task UploadImage()
    {
        try
        {
            await GitHubService.PushImageFile("SaintScraTchY", "StaticBlazePOC", gitUpload.GitFilePath, gitUpload.ImageBytes, gitUpload.GitHubPat);
            Console.WriteLine("Image uploaded successfully!");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
    }
}